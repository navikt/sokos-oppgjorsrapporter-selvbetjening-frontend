---
import type { Language } from '@src/language/language.ts';
import RapportKort from '../RapportKort.tsx';
import { ErrorSummary } from '@navikt/ds-react/ErrorSummary';
import { actions } from 'astro:actions';

const { id } = Astro.props;

let rapportMetaData = null;
let error: string | null = null;

if (!id) {
  error = 'Mangler rapport id i URL';
} else {
  const result = await Astro.callAction(actions.getRapportMetadata, { id });

  if (result.error) {
    error = result.error.message;
  } else {
    rapportMetaData = result.data;
  }
}

const language = Astro.currentLocale as Language;
---

{error && <ErrorSummary heading="Det oppstod en feil">{error}</ErrorSummary>}

{
  !error && rapportMetaData && (
    <RapportKort
      rapportMetaData={rapportMetaData}
      language={language}
      client:load
    />
  )
}
