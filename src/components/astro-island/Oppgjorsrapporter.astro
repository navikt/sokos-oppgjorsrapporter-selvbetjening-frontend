---
import { oppgjorsrapporterApiUrl } from '@src/utils/server/urls';
import type { Language } from '@src/language/language';
import type { RapportMetadata } from '@src/types/rapport-metadata';
import RapportKort from '../RapportKort.tsx';
import { ErrorSummary } from '@navikt/ds-react/ErrorSummary';

const { id } = Astro.props;

let rapportMetaData: RapportMetadata | null;
let error: string | null = null;

if (!id) error = 'Mangler rapport id i URL';

const url = `${oppgjorsrapporterApiUrl}?id=${encodeURIComponent(id)}`;

const response = await fetch(url);

if (!response.ok) {
  error = `Failed to fetch rapport metadata for id=${id}`;
}

rapportMetaData = await response.json();

const language = Astro.currentLocale as Language;
---

{error && <ErrorSummary heading="Det oppstod en feil">{error}</ErrorSummary>}

{
  !error && rapportMetaData && (
    <RapportKort
      rapportMetaData={rapportMetaData}
      language={language}
      client:load
    />
  )
}
